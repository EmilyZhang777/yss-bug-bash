{namespace cobalt.atoms}

/**
 * @param baseClass
 *
 * @param? baseUrl
 * @param? siteDomain
 * @param? locale
 *
 * @param video
 * @param? provider
 * @param? options
 * @param? width
 * @param? height
 * @param? isLocal
 */
{template .Video}
  {let $defaultProvider}
    {if $provider}
      {$provider |casing:'lower'}
    {else}
      native
    {/if}
  {/let}
  {let $defaultWidth: 600 /}
  {let $defaultHeight: 340 /}

  {let $class}
    {call cobalt.helpers.class_builder data="all"}
      {param name: 'Video' /}
      {param modifiers: [$defaultProvider] /}
    {/call}
  {/let}

  <div class="{$class}">
    {switch $defaultProvider}
      {case 'youtube'}
        {call .VideoYoutube data="all"}
          {param width: $width ?: $defaultWidth /}
          {param height: $height ?: $defaultHeight /}
        {/call}
      {case 'vimeo'}
        {call .VideoVimeo data="all"}
          {param width: $width ?: $defaultWidth /}
          {param height: $height ?: $defaultHeight /}
        {/call}
      {default}
        {call .VideoLocal data="all"}
          {param width: $width ?: $defaultWidth /}
          {param height: $height ?: $defaultHeight /}
        {/call}
    {/switch}
  </div>
{/template}

/**
 * @param? siteDomain
 * @param? locale
 *
 * @param video
 * @param? options
 * @param width
 * @param height
 */
{template .VideoYoutube}
  {let $qp}
    {call cobalt.util.QueryParams}
      {param params: $options /}
    {/call}
  {/let}
  // force required parameters
  {let $isFirst: $options ? '&' : '?' /}
  {let $builtIn: $isFirst + 'origin=' + $siteDomain + '&cc_lang-pref=' + $locale + '&hl=' + $locale /}
  <iframe
    class="Video-player"
    type="text/html"
    width="{$width}"
    height="{$height}"
    src="https://www.youtube.com/embed/{$video}{$qp}{$builtIn}"
    frameborder="0"
  >
  </iframe>
{/template}

/**
 * @param video
 * @param options
 * @param width
 * @param height
 */
{template .VideoVimeo}
  {let $qp}
    {call cobalt.util.QueryParams}
      {param params: $options /}
    {/call}
  {/let}

  <iframe
    class="Video-player"
    src="https://player.vimeo.com/video/{$video}{$qp}"
    width="{$width}"
    height="{$height}"
    frameborder="0"
    allow="autoplay; fullscreen"
    allowfullscreen
  >
  </iframe>
{/template}

/**
 * @param baseUrl
 *
 * @param video
 * @param? options
 * @param width
 * @param height
 * @param? isLocal
 */
{template .VideoLocal}
  <video
    width="{$width}"
    height="{$height}"
    {if ($options?.autoplay ?: 0) == 1}autoplay{/if}
    {if ($options?.controls ?: 1) == 1}controls{/if}
  >
    {foreach $format in keys($video)}
      <source src="{$isLocal ? $baseUrl : ''}{$video[$format]}" type="video/{$format}">
    {/foreach}
    Your browser does not support the video tag.
  </video>
{/template}
