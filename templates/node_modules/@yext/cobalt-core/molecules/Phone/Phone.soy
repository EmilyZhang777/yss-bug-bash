{namespace cobalt.molecules}

/**
 * Class passthroughs
 * @param baseClass
 * @param? subClass
 * @param? modifiers
 * @param? attributes
 *
 * Entity params
 * @param profile
 * @param? field
 *
 * Content params
 * @param? displayText
 * @param? label
 *
 * Config params
 * @param? alwaysLink
 *
 * Meta params
 * @param? itemprop
 * @param? yaTrack
 */
{template .Phone_profile}
  {let $isMain: $field == 'main' or not $field /}

  {let $itemProp_default}
    {if $isMain}
      telephone
    {elseif $field == 'fax'}
      faxNumber
    {/if}
  {/let}

  {let $phone: $field ? $profile[$field] : $profile.mainPhone /}

  {if $phone}
    {call .Phone data="all"}
      {param itemprop: $itemprop ?: $itemProp_default /}
      {param number: $phone.number /}
      {param displayText: $displayText ?: $phone.display /}
    {/call}
  {/if}
{/template}

/**
 * Class passthroughs
 * @param baseClass
 * @param? subClass
 * @param? modifiers
 * @param? attributes
 *
 * Content params
 * @param number
 * @param? displayText
 * @param? label
 *
 * Config params
 * @param? alwaysLink
 *
 * Meta params
 * @param? itemprop
 * @param? yaTrack
 */
{template .Phone}
  {let $class}
    {call cobalt.helpers.class_builder data="all"}
      {param name: 'Phone' /}
    {/call}
  {/let}
  {let $attribute}
    {call cobalt.helpers.attribute_builder data="all" /}
  {/let}

  <div
    class="{$class}"
    {if $attribute} {$attribute |noAutoescape}{/if}
  >
    {if $label}
      {call cobalt.atoms.Text data="all"}
        {param baseClass: 'Phone' /}
        {param subClass: 'label' /}
        {param content: $label /}
        {param tag: 'span' /}
      {/call}
    {/if}
    {if not $alwaysLink}
      <div class="Phone-display l-hidden-xs">
        {call cobalt.atoms.Text data="all"}
          {param baseClass: 'Phone' /}
          {param subClass: 'display' /}
          {param content: $displayText ?: $number /}
          {param tag: 'span' /}
        {/call}
      </div>
    {/if}

    <div class="Phone-linkWrapper{if not $alwaysLink} l-visible-only-xs{/if}">
      {call .Phone_link data="all" /}
    </div>
  </div>
{/template}

/**
 * Class passthroughs
 * @param baseClass
 * @param? subClass
 * @param? modifiers
 * @param? attributes
 *
 * Content params
 * @param number
 * @param? displayText
 *
 * Meta params
 * @param? itemprop
 * @param? yaTrack
 */
{template .Phone_link}
  {call cobalt.atoms.Link data="all"}
    {param baseClass: 'Phone' /}
    {param href: 'tel:' + stripOutPhoneDigits($number) /}
    {param yaTrack: $yaTrack ?: 'phone' /}
    {param content: $displayText ?: $number /}
  {/call}
{/template}
